### 需求分析
#### 平台方的业务需求是：
##### 可以较为方便的维护秒杀活动的开始时间，以及货物与数量
##### 可以让用户比较便捷地参与秒杀系统
##### 秒杀可以正确的反应用户秒杀的情况，并且把秒杀的结果返回给用户
##### 秒杀成功之后，要把需要发的订单发送给物流系统进行发货处理
##### 秒杀系统发生任何问题，都不应该影响电商平台的正常使用

#### 用户方的业务需求是：
##### 可以正常查看秒杀活动页
##### 可以在秒杀活动开始的时候，顺利参与秒杀活动
##### 秒杀活动的参与结果要在一定时间内返回给用户
##### 秒杀得到的商品可以顺利发货并且送达用户手中
##### 秒杀应该保证公正，先到先得

#### 需求分解
##### 平台方的需求：
##### 1.要求我们完成一个运维的功能与秒杀实现的功能，可以新增秒杀活动，并且设置货物与数量，以及开始时间
##### 2.所有登陆的有效用户都要能够参与秒杀活动，因此参与人数可能会非常多，系统要能容下这么多的用户参与，这是一个高并发场景
##### 3.在秒杀结束后，我们要可以同步或者异步地将用户是否秒中的结果告知用户
##### 4.秒中的那些用户的订单要直接给物流系统进行发货操作
##### 5.秒杀系统应该与电商平台系统完全隔离，最好是隔离到两个不同的服务器节点。这样即使因为某些bug导致服务器宕机，也不会影响电商平台的正常运行

### 概要设计：
#### 业务场景：
##### 1.在活动开始前，运维人员先在一个运营后台去维护秒杀活动对应的商品以及其数量，维护完成后发布秒杀活动.
##### 2.用户看到秒杀活动发布后，等到规定时间，点秒杀按钮进行秒杀，然后等待结果。
##### 3.大约1分钟左右，秒杀的结果会在页面上展示

#### 体量预估
##### 按照目前我们的优易系统的订单量，一天大约200~400万，而某个商户最多一天大约4~5万单左右。
##### 如此，我们假设秒杀活动会吸引平常20倍的用户，那么就按照100万的用户量进行统计，这个是秒杀系统要能承载的用户量

### 整体设计

## 技术选型
##### 1.前端使用react，这个我们公司使用最多，也最能进行前端组件的重用
##### 2.消息队列可以用kafka，因为如果在我们公司的话，kafka用的比较多，而且kafka便于扩展，而这个需求里也没有用到事务消息，所以不需要用rocketMq这样的消息中间件
##### 3.网关使用聚石塔的SLB
##### 4.使用阿里的聚石塔的云原生来作为容器管理的平台
##### 5.缓存使用redis，也是因为聚石塔上有线程的redis集群模式，可以直接拿来使用
##### 6.数据库使用mysql，因为云原生的应用的话，使用mysql会比较好，oracle因为迁移困难，所以一般云产品不怎么使用。

## 业务处理流程
##### 1.用户的请求先经过SLB
##### 2.然后经过Ingress，转发到k8s的service
##### 3.最终发给对应的容器服务
##### 4.容器服务接受到请求后，开始处理请求，然后原路返回给浏览器
##### 5.消息队列接收秒杀的请求，然后在消费的时候去全局修改一个redis里的值，当这个值达到秒杀规定的库存时，之后的请求都设置为秒杀失败
##### 6.写redis值的时候，需要用分布式锁来锁住这个redis值
##### 7.在秒杀成功过后，每一个成功的请求发送消息到物流服务，直接准备发货操作

## 系统架构图
##### 见附件架构图
